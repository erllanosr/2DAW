<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <title>Document</title>
  </head>
  <body>
    <div class="container py-5 text-center">
      <h1></h1>
      <label for="usuario">Usuario</label>
      <input type="text" id="username" class="form-control" />
      <br />
      <label for="clave">Clave</label>
      <input type="text" class="form-control" id="clave" />
      <br />
      <input type="radio" name="baseDatos" value="1" id="websql_input" />Web SQL
      <input type="radio" name="baseDatos" value="2" class="indexeddb_input" />IndexedDB

      <button class="btn btn-primary" onclick="insertar()" id="btn_insertar">Insertar datos</button>
      <button class="btn btn-primary" onclick="borrarDatos()">Eliminar tabla</button>
      <button class="btn btn-primary" onclick="modificar (1, 'Lola', '654321')">Modificar</button>
      <button class="btn btn-primary" onclick="consultar()">Consultar datos</button>
      <div id="demo"></div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.6.3.js"
      integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript">
      var user = document.getElementById("username");
      var clave = document.getElementById("clave");
      var opcion1 = document.getElementById("websql_input");
      var opcion2 = document.getElementById("indexeddb_input");

      var boton_insertar = document.getElementById("btn_insertar");
      var boton_eliminar = document.getElementById("btn_eliminar");
      var boton_modificar = document.getElementById("btn_modificar");
      var boton_consultar = document.getElementById("btn_consultar");

      console.log(user.value);
      console.log(clave.value);

      // Si se crea el nombre de la base de datos, el nombre de la tabla se ha creado en otro webSQL anteriormente, entonces se hará referencia directa al contenido de los datos y no se creará ninguna nueva.

      // Establecer nombre de la base de datos, versión, grupo de conexiones, tamaño
      var webbd = window.openDatabase("datos.db", "1.0", null, 20000);
      // crear tabla
      webbd.transaction(function (tr) {
        tr.executeSql("create table usuarios(_id integer primary key autoincrement,nombre text,clave text)");
      });

      // Agregar, eliminar y modificar el formato webbd.executeSql ("instrucción sql", [parámetro])

      // Insertar datos

      // Esta función debe estar dentro de un if, pero cómo¿?
      function insertar() {
        document.getElementById("websql_input").checked = true;
        webbd.transaction(function (tr) {
          console.log(tr); // Una SQLTransaction {}
          tr.executeSql("insert into usuarios (nombre, clave) values (?,?)", [user.value, clave.value]);
        });
      }
      function hola() {
        document.getElementById("indexeddb_input").checked = true;
        alert("HOLA");
      }

      // Eliminar la base de datos
      function borrarDatos() {
        webbd.transaction(function (tr) {
          tr.executeSql("drop table usuarios");
        });
      }

      // Modificar los datos
      function modificar(id, nuevoNombre, nuevaClave) {
        webbd.transaction(function (tr) {
          tr.executeSql("update usuarios set nombre=?,clave=? where _id=?", [nuevoNombre, nuevaClave, id]);
        });
      }

      // Consultar datos
      function consultar() {
        webbd.transaction(function (tr) {
          // resultado devuelve una matriz
          tr.executeSql("select * from usuarios", [], function (tr, result) {
            console.log(result);
            var contenido = "";
            for (var i = 0; i < result.rows.length; i++) {
              let dd = result.rows[i];
              contenido += "<p>" + dd._id + "." + dd.nombre + " --- " + dd.clave + "</p>";
            }
            $("#demo").html(contenido);
          }); //tr.executeSql
        });
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
